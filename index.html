<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Happy Diwali</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Lobster&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#070416; --bg2:#1e0a3c;
  --text:#fff;
  --pink:#ff8fab; --gold:#ffd166; --sky:#7dd3fc; --vio:#c084fc; --mint:#6ee7b7;
  --twinkle:#ffffff12;
  --titleSize: clamp(34px, 9.5vw, 96px);
  --wishSize:  clamp(18px, 6vw, 40px);
}

/* Base */
*{box-sizing:border-box}
html,body{height:100%;margin:0;color:var(--text);font-family:"Baloo 2",system-ui,-apple-system,Segoe UI,Roboto,Arial}
body{
  background:
    radial-gradient(120% 120% at 80% 10%, #120a2e 0%, transparent 60%),
    linear-gradient(160deg,var(--bg1),var(--bg2) 70%);
  -webkit-font-smoothing:antialiased;
  overflow:hidden;
}

/* Canvas behind all */
#sky{position:fixed;inset:0;width:100%;height:100%;display:block;z-index:0}

/* Layout (no overlap) */
.main{
  position:relative; z-index:2;
  min-height:100svh;
  display:grid;
  grid-template-rows: 1fr auto 1fr;
  align-items:center;
  justify-items:center;
  padding:4vh 4vw;
}

/* Title */
.title{
  text-align:center;
  font-family:"Lobster",cursive;
  font-size:var(--titleSize);
  line-height:1.05;
  letter-spacing:.5px;
  background:linear-gradient(90deg,var(--pink),var(--gold),var(--sky),var(--vio),var(--mint),var(--gold));
  background-size:240% 100%;
  -webkit-background-clip:text; background-clip:text; color:transparent;
  animation:shine 5.6s linear infinite, pop 3s ease-in-out infinite;
  -webkit-text-stroke: 1px rgba(255,255,255,.12);
  text-shadow:0 8px 28px rgba(0,0,0,.55), 0 0 24px rgba(255,220,150,.25);
}
.title-underline{
  height:4px; width:min(420px, 58vw); border-radius:999px; margin-top:.6rem;
  background:linear-gradient(90deg,transparent,#ffd166cc,transparent);
  animation:underline 2.8s ease-in-out infinite;
}

/* Wishes â€” moved UP via margin-bottom:22vh */
#wish{
  grid-row:3;
  align-self:end;
  margin-bottom:22vh; /* â†‘ upar */
  text-align:center;
  font-weight:800;
  font-size:var(--wishSize);
  padding:0 .6rem;
  background:linear-gradient(90deg,var(--gold),var(--pink),var(--vio),var(--sky),var(--gold));
  background-size:220% 100%;
  -webkit-background-clip:text; background-clip:text; color:transparent;
  -webkit-text-stroke: 0.6px rgba(255,255,255,.10);
  text-shadow:0 10px 28px rgba(0,0,0,.55), 0 0 14px rgba(255,210,120,.18);
  animation:shine 6s linear infinite, wishIn 2s ease forwards;
}

/* Stars overlay */
body::before{
  content:"";position:fixed;inset:0;z-index:1;pointer-events:none;
  background-image:
    radial-gradient(2px 2px at 12% 20%, var(--twinkle), transparent),
    radial-gradient(2px 2px at 72% 65%, var(--twinkle), transparent),
    radial-gradient(1.5px 1.5px at 30% 80%, var(--twinkle), transparent),
    radial-gradient(1.5px 1.5px at 90% 35%, var(--twinkle), transparent);
  mix-blend-mode:screen;
}

/* ðŸ”Š Sound unlock pill (shows only if needed) */
#soundUnlock{
  position:fixed; left:50%; bottom:14vh; transform:translateX(-50%);
  z-index:3; display:none; /* default hidden */
  padding:.6rem .9rem; border-radius:999px;
  background:linear-gradient(90deg,#ffffff1a,#ffffff10);
  border:1px solid #ffffff33;
  backdrop-filter:blur(6px) saturate(1.2);
  font-weight:800; letter-spacing:.3px;
  cursor:pointer; user-select:none;
  box-shadow:0 10px 28px rgba(0,0,0,.35);
}
#soundUnlock span{
  background:linear-gradient(90deg,var(--gold),var(--pink),var(--vio),var(--sky),var(--gold));
  background-size:220% 100%;
  -webkit-background-clip:text; background-clip:text; color:transparent;
  animation:shine 6s linear infinite;
}

/* Keyframes */
@keyframes shine{0%{background-position:0% 0}100%{background-position:220% 0}}
@keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
@keyframes underline{0%,100%{opacity:.65;transform:scaleX(.95)}50%{opacity:1;transform:scaleX(1)}}
@keyframes wishIn{
  0%{opacity:0;transform:translateY(8px) scale(.98);filter:blur(6px)}
  30%{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}
  85%{opacity:1}
  100%{opacity:0;transform:translateY(-8px) scale(1.02);filter:blur(3px)}
}

/* Mobile tweaks */
@media (max-width:480px){
  .main{padding:3vh 3vw}
  #wish{margin-bottom:24vh}
}
</style>
</head>
<body>
<canvas id="sky"></canvas>

<section class="main" aria-live="polite">
  <div></div>
  <div class="title-wrap" style="text-align:center">
    <div class="title">ðŸŽ‡ Happy Diwali ðŸŽ†</div>
    <div class="title-underline"></div>
  </div>
  <p id="wish"></p>
</section>

<!-- Music: muted autoplay; unmute on first gesture -->
<audio id="bg" src="songs/song1.mp3" preload="auto" loop playsinline muted autoplay></audio>
<button id="soundUnlock" type="button" aria-label="Enable sound"><span>ðŸ”Š Tap for Sound</span></button>

<script>
/* ================= MUSIC: Real-world unlock flow ================= */
const bg = document.getElementById('bg');
const pill = document.getElementById('soundUnlock');

// WebAudio context (helps on some Androids/iOS after gesture)
let audioCtx;
function ensureAudioContext(){
  try{
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state !== 'running') return audioCtx.resume();
  }catch(e){}
}

let tries=0, retryIv=null;
function hidePill(){ pill.style.display='none'; }
function showPill(){ pill.style.display='inline-block'; }

async function tryPlay(unmute=false){
  try{
    if(unmute){ bg.muted=false; }
    await bg.play();
    // smooth quick fade
    try{ bg.volume = 0.0; }catch(e){}
    const target=0.9, step=0.18, ms=90;
    const iv = setInterval(()=>{
      try{
        bg.volume = Math.min(target, (bg.volume||0)+step);
        if(bg.volume>=target || bg.paused) clearInterval(iv);
      }catch(e){ clearInterval(iv); }
    }, ms);
    hidePill();
    return true;
  }catch(e){
    return false;
  }
}

async function kickAuto(){
  // First, muted autoplay attempt (should work in most)
  const ok1 = await tryPlay(false);
  if(ok1) return;

  // If blocked, prep unlock UI & aggressive retries for a short window
  showPill();
  if(!retryIv){
    retryIv = setInterval(async ()=>{
      tries++;
      const ok = await tryPlay(false);
      if(ok || tries>20){ clearInterval(retryIv); retryIv=null; }
    }, 200);
  }
}

document.addEventListener('DOMContentLoaded', kickAuto, {once:true});
window.addEventListener('load', kickAuto, {once:true});

// Global gesture unlocks (ANY tap/press/focus)
async function userUnlock(){
  await ensureAudioContext();
  const ok = await tryPlay(true);
  hidePill();
}
['pointerdown','click','keydown','touchstart'].forEach(evt=>{
  window.addEventListener(evt, userUnlock, {once:true, passive:true});
});
document.addEventListener('visibilitychange', ()=>{ if(!document.hidden) userUnlock(); }, {once:true});
pill.addEventListener('click', userUnlock);

/* ================= CANVAS FX (fast fireworks) ================= */
const canvas = document.getElementById('sky');
const ctx = canvas.getContext('2d',{alpha:true});
let W = canvas.width = innerWidth, H = canvas.height = innerHeight;
addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; });

/* Stars */
const STAR_LAYERS = [
  {count:160, speed:.03, size:[.6,1.2], alpha:.55},
  {count:90,  speed:.05, size:[.8,1.8], alpha:.75},
  {count:36,  speed:.08, size:[1.2,2.4], alpha:.95}
];
let stars=[];
function initStars(){
  stars = [];
  STAR_LAYERS.forEach((L,idx)=>{
    for(let i=0;i<L.count;i++){
      stars.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*(L.size[1]-L.size[0])+L.size[0],a:L.alpha,s:L.speed,z:idx+1});
    }
  });
}
initStars();

/* Comets (fast) */
let comets=[];
function spawnComet(){
  const y = Math.random()*H*0.55;
  comets.push({x:-80,y, vx:9+Math.random()*6, vy:1.2+Math.random()*0.8, life:110});
}
setInterval(()=>{ if(Math.random()<0.45) spawnComet(); }, 2800);

/* Fireworks â€” ULTRA FAST + MANY */
class Particle{
  constructor(x,y,vx,vy,life,col,size,trail=false){
    this.x=x; this.y=y; this.vx=vx; this.vy=vy;
    this.life=life; this.max=life; this.col=col; this.size=size; this.trail=trail;
  }
  step(dt){
    this.vy += 0.03*dt;
    this.vx *= 0.994; this.vy *= 0.994;
    this.x += this.vx*dt; this.y += this.vy*dt;
    this.life -= dt;
  }
  draw(){
    const t = Math.max(0, this.life/this.max);
    ctx.globalCompositeOperation='lighter';
    ctx.fillStyle=`rgba(${this.col.r},${this.col.g},${this.col.b},${Math.max(.06,t)})`;
    ctx.beginPath(); ctx.arc(this.x,this.y,this.size*(1+(1-t)),0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=Math.max(.04,t*.32);
    ctx.beginPath(); ctx.arc(this.x,this.y,this.size*6.5,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1;
    if(this.trail){
      ctx.globalAlpha=.10*t;
      ctx.beginPath(); ctx.arc(this.x-this.vx*2.4,this.y-this.vy*2.4,this.size*3.4,0,Math.PI*2); ctx.fill();
      ctx.globalAlpha=1;
    }
  }
}
const rng=(a,b)=>Math.random()*(b-a)+a;
const COLORS=[{r:255,g:140,b:120},{r:110,g:220,b:255},{r:255,g:230,b:130},{r:200,g:120,b:255},{r:120,g:255,b:170},{r:255,g:180,b:230}];
let parts=[], rockets=[];

function burst(x,y,force=1.6){
  const col = COLORS[(Math.random()*COLORS.length)|0];
  const n = Math.floor(rng(150,250)*force);
  for(let i=0;i<n;i++){
    const ang=Math.random()*Math.PI*2, sp=rng(3.2,10.2)*(0.8+Math.random()*force);
    const trail = Math.random()<0.7;
    parts.push(new Particle(x,y,Math.cos(ang)*sp,Math.sin(ang)*sp,rng(36,100),col,rng(1.2,4.8),trail));
  }
  for(let k=0;k<22;k++){
    parts.push(new Particle(x,y,rng(-0.9,0.9),rng(-0.9,0.9),rng(22,42),col,rng(2.6,3.4),false));
  }
}
function launchRocket(x=null){
  const px = x ?? rng(60,W-60);
  const startY=H+20, peak=rng(H*.18,H*.45);
  rockets.push({x:px,y:startY,vy:-rng(5.8,9.5),vx:rng(-0.55,0.55),peak,boom:false});
}

/* Loop */
let last=performance.now();
function loop(now){
  const dt=Math.min(42, now-last)/16.6; last=now;
  ctx.clearRect(0,0,W,H);

  // stars
  for(const s of stars){
    s.x += s.s*dt*10; if(s.x>W+4) s.x=-4;
    ctx.globalAlpha=s.a; ctx.fillStyle="#fff";
    ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();
  }
  ctx.globalAlpha=1;

  // comets
  for(let i=comets.length-1;i>=0;i--){
    const c=comets[i];
    c.x += c.vx*dt*2.4; c.y += c.vy*dt*2.4; c.life -= dt;
    ctx.globalCompositeOperation='lighter';
    ctx.fillStyle="rgba(255,255,255,.9)";
    ctx.beginPath(); ctx.arc(c.x,c.y,1.8,0,Math.PI*2); ctx.fill();
    const grd=ctx.createLinearGradient(c.x-48,c.y-48,c.x,c.y);
    grd.addColorStop(0,"rgba(125,211,252,0)");
    grd.addColorStop(1,"rgba(255,255,255,.4)");
    ctx.strokeStyle=grd; ctx.lineWidth=2.2;
    ctx.beginPath(); ctx.moveTo(c.x-48,c.y-48); ctx.lineTo(c.x,c.y); ctx.stroke();
    ctx.globalCompositeOperation='source-over';
    if(c.life<=0 || c.x>W+70) comets.splice(i,1);
  }

  // rockets
  for(let i=rockets.length-1;i>=0;i--){
    const r=rockets[i];
    r.x += r.vx*dt; r.y += r.vy*dt; r.vy += 0.18*dt;
    ctx.globalCompositeOperation='lighter';
    ctx.fillStyle="rgba(255,230,160,.95)";
    ctx.beginPath(); ctx.arc(r.x,r.y,2.4,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=.38; ctx.beginPath(); ctx.arc(r.x,r.y,11,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1; ctx.globalCompositeOperation='source-over';
    if(!r.boom && r.y<=r.peak){ r.boom=true; burst(r.x,r.y,rng(1.6,2.2)); rockets.splice(i,1); }
    else if(r.y<-60) rockets.splice(i,1);
  }

  // particles
  for(let i=parts.length-1;i>=0;i--){
    const p=parts[i]; p.step(dt); p.draw();
    if(p.life<=0 || p.y>H+70 || p.x<-70 || p.x>W+70) parts.splice(i,1);
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* Continuous ultra-fast cadence */
function cadence(){
  const rocketsNow = (Math.random()<0.5)?3:2;
  for(let i=0;i<rocketsNow;i++) setTimeout(()=>launchRocket(), i*90);
  if(Math.random()<0.4){
    const bx=rng(80,W-80), by=rng(H*0.20,H*0.5);
    setTimeout(()=>burst(bx,by,rng(1.6,2.2)), 160);
  }
  setTimeout(cadence, rng(250,450));
}
cadence();

/* Tap to burst */
canvas.addEventListener('pointerdown', e=>{
  const r=canvas.getBoundingClientRect();
  const x=(e.clientX-r.left)*(canvas.width/r.width);
  const y=(e.clientY-r.top)*(canvas.height/r.height);
  for(let i=0;i<4;i++) burst(x+rng(-24,24), y+rng(-24,24), rng(1.5,2.2));
});

/* Cap for performance */
setInterval(()=>{ if(parts.length>5200) parts.splice(0, parts.length-3600); }, 900);

/* Wishes */
const LINES = [
  "âœ¨ Shubh Deepawali âœ¨",
  "ðŸ’¥ Khushiyon ke patake, dil se duaayein ðŸ’¥",
  "ðŸª” Roshni, Pyaar aur Prosperity",
  "ðŸŽ‰ Mithai aur Muskaan se ghar bhar jaye",
  "ðŸŒŸ Lakshmi ji ki kripa sada bani rahe"
];
const wish = document.getElementById('wish');
let wi=0;
function showWish(){
  wish.textContent = LINES[wi%LINES.length];
  wi++;
  wish.style.animation='none'; void wish.offsetWidth;
  wish.style.animation='shine 6s linear infinite, wishIn 2s ease forwards';
}
showWish();
setInterval(showWish, 2000);
</script>
</body>
</html>
